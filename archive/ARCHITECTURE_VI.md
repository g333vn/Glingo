# ğŸ—ï¸ Há»‡ Thá»‘ng XÃ¡c Thá»±c - HÆ°á»›ng Dáº«n Kiáº¿n TrÃºc

## Tá»•ng Quan Há»‡ Thá»‘ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (React)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   LoginPage      â”‚  â”‚  RegisterPage    â”‚                   â”‚
â”‚  â”‚  (Giao diá»‡n Ä‘áº¹p) â”‚  â”‚  (Form + Valid)  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â”‚                     â”‚                             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                      â”‚                                        â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚           â”‚  useAuthActions()     â”‚                          â”‚
â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                          â”‚
â”‚           â”‚  â”‚ handleLogin      â”‚ â”‚                          â”‚
â”‚           â”‚  â”‚ handleRegister   â”‚ â”‚                          â”‚
â”‚           â”‚  â”‚ handleLogout     â”‚ â”‚                          â”‚
â”‚           â”‚  â”‚ handleUpdateProf â”‚ â”‚                          â”‚
â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                       â”‚                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚           â”‚   AuthContext (ToÃ n Cá»¥c)  â”‚                      â”‚
â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                      â”‚
â”‚           â”‚  â”‚ user               â”‚  â”‚                      â”‚
â”‚           â”‚  â”‚ profile            â”‚  â”‚                      â”‚
â”‚           â”‚  â”‚ isAuthenticated    â”‚  â”‚                      â”‚
â”‚           â”‚  â”‚ isLoading          â”‚  â”‚                      â”‚
â”‚           â”‚  â”‚ login()            â”‚  â”‚                      â”‚
â”‚           â”‚  â”‚ register()         â”‚  â”‚                      â”‚
â”‚           â”‚  â”‚ logout()           â”‚  â”‚                      â”‚
â”‚           â”‚  â”‚ updateProfile()    â”‚  â”‚                      â”‚
â”‚           â”‚  â”‚ hasPermission()    â”‚  â”‚                      â”‚
â”‚           â”‚  â”‚ isAdmin()          â”‚  â”‚                      â”‚
â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                       â”‚                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚           â”‚ Táº§ng Services         â”‚                         â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
â”‚           â”‚ authService.js        â”‚ â”€â”€â”                     â”‚
â”‚           â”‚ (ÄÄƒng kÃ½/Ä‘Äƒng nháº­p/xuáº¥t)â”‚   â”‚                     â”‚
â”‚           â”‚                       â”‚   â”‚                     â”‚
â”‚           â”‚ userMgmtService.js    â”‚ â”€â”€â”¼â”€ Wrap Supabase     â”‚
â”‚           â”‚ (Thao tÃ¡c Admin)      â”‚   â”‚  API Calls          â”‚
â”‚           â”‚                       â”‚   â”‚                     â”‚
â”‚           â”‚ supabaseClient.js     â”‚ â”€â”€â”˜                     â”‚
â”‚           â”‚ (Cáº¥u hÃ¬nh & Khá»Ÿi táº¡o) â”‚                         â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                       â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ HTTPS/REST API
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SUPABASE BACKEND (Cloud)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  auth.users      â”‚  â”‚   profiles       â”‚                  â”‚
â”‚  â”‚  (Email/Pass)    â”‚  â”‚   (Dá»¯ liá»‡u       â”‚                  â”‚
â”‚  â”‚  (Session)       â”‚  â”‚    User má»Ÿ rá»™ng) â”‚                  â”‚
â”‚  â”‚  (JWT Tokens)    â”‚  â”‚   (Roles)        â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ activity_logs    â”‚  â”‚   RLS Policies   â”‚                  â”‚
â”‚  â”‚ (Audit Trail)    â”‚  â”‚  (Báº£o máº­t hÃ ng)  â”‚                  â”‚
â”‚  â”‚ (HÃ nh Ä‘á»™ng)      â”‚  â”‚  (Quyá»n)         â”‚                  â”‚
â”‚  â”‚ (Timestamps)     â”‚  â”‚  (Truy cáº­p dá»¯ liá»‡u)â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚  â”‚  storage/avatars â”‚                                         â”‚
â”‚  â”‚  (Táº£i file)      â”‚                                         â”‚
â”‚  â”‚  (CDN)           â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## SÆ¡ Äá»“ Luá»“ng Dá»¯ Liá»‡u

### 1. Luá»“ng ÄÄƒng KÃ½

```
User Ä‘iá»n form (email, password, tÃªn)
         â”‚
         â–¼
validateForm() â”€ kiá»ƒm tra email, Ä‘á»™ dÃ i password, Ä‘iá»u khoáº£n
         â”‚
         â”œâ”€ KhÃ´ng há»£p lá»‡: Hiá»ƒn thá»‹ lá»—i
         â”‚
         â”œâ”€ Há»£p lá»‡: Tiáº¿p tá»¥c
         â”‚
         â–¼
handleRegister() trong useAuthActions
         â”‚
         â–¼
authService.signUp({ email, password, displayName })
         â”‚
         â–¼
supabase.auth.signUp()
         â”‚
         â”œâ”€ âœ… ThÃ nh cÃ´ng
         â”‚   â””â”€ Báº£n ghi auth.users Ä‘Æ°á»£c táº¡o
         â”‚   â””â”€ Session token Ä‘Æ°á»£c táº¡o
         â”‚   â””â”€ Trigger: handle_new_user() kÃ­ch hoáº¡t
         â”‚       â””â”€ Báº£n ghi profiles tá»± Ä‘á»™ng táº¡o
         â”‚       â””â”€ Role Ä‘Æ°á»£c Ä‘áº·t thÃ nh 'user'
         â”‚   â””â”€ Email xÃ¡c minh Ä‘Æ°á»£c gá»­i
         â”‚   â””â”€ Tráº£ vá» thÃ nh cÃ´ng
         â”‚
         â””â”€ âŒ Lá»—i
             â””â”€ Tráº£ vá» thÃ´ng bÃ¡o lá»—i
             â””â”€ Hiá»ƒn thá»‹ cho user
```

### 2. Luá»“ng ÄÄƒng Nháº­p

```
User gá»­i email & password
         â”‚
         â–¼
validateForm()
         â”‚
         â”œâ”€ KhÃ´ng há»£p lá»‡: Hiá»ƒn thá»‹ lá»—i
         â”‚
         â”œâ”€ Há»£p lá»‡: Tiáº¿p tá»¥c
         â”‚
         â–¼
handleLogin() trong useAuthActions
         â”‚
         â–¼
authService.signIn({ email, password })
         â”‚
         â–¼
supabase.auth.signInWithPassword()
         â”‚
         â”œâ”€ âœ… ThÃ nh cÃ´ng
         â”‚   â””â”€ Session token Ä‘Æ°á»£c cáº¥p
         â”‚   â””â”€ LÆ°u trong localStorage
         â”‚   â””â”€ SIGNED_IN event kÃ­ch hoáº¡t
         â”‚   â””â”€ AuthContext phÃ¡t hiá»‡n thay Ä‘á»•i
         â”‚   â””â”€ loadUserProfile() Ä‘Æ°á»£c gá»i
         â”‚       â””â”€ Láº¥y tá»« báº£ng profiles
         â”‚       â””â”€ Cáº­p nháº­t user state
         â”‚   â””â”€ Components re-render
         â”‚   â””â”€ Chuyá»ƒn hÆ°á»›ng Ä‘áº¿n dashboard
         â”‚
         â””â”€ âŒ Lá»—i
             â””â”€ ThÃ´ng tin Ä‘Äƒng nháº­p khÃ´ng há»£p lá»‡
             â””â”€ User khÃ´ng tÃ¬m tháº¥y
             â””â”€ Email chÆ°a Ä‘Æ°á»£c xÃ¡c minh
             â””â”€ Hiá»ƒn thá»‹ lá»—i
```

### 3. KhÃ´i Phá»¥c Session (Reload Trang)

```
Trang reload
         â”‚
         â–¼
AuthContext mount
         â”‚
         â–¼
Kiá»ƒm tra cáº¥u hÃ¬nh Supabase
         â”‚
         â”œâ”€ ChÆ°a cáº¥u hÃ¬nh: setIsLoading(false)
         â”‚
         â”œâ”€ ÄÃ£ cáº¥u hÃ¬nh: Tiáº¿p tá»¥c
         â”‚
         â–¼
onAuthStateChange() listener báº¯t Ä‘áº§u
         â”‚
         â–¼
INITIAL_SESSION event kÃ­ch hoáº¡t
         â”‚
         â”œâ”€ âœ… TÃ¬m tháº¥y session
         â”‚   â””â”€ loadUserProfile(session.user)
         â”‚   â””â”€ Láº¥y tá»« báº£ng profiles
         â”‚   â””â”€ setUser() + setProfile()
         â”‚   â””â”€ setIsLoading(false)
         â”‚
         â””â”€ âŒ KhÃ´ng cÃ³ session
             â””â”€ setUser(null)
             â””â”€ setProfile(null)
             â””â”€ setIsLoading(false)
             â””â”€ Hiá»ƒn thá»‹ trang login
```

### 4. Luá»“ng Cáº­p Nháº­t User Admin

```
Admin click "Change Role"
         â”‚
         â–¼
changeUserRole(userId, newRole)
         â”‚
         â–¼
userService.changeUserRole()
         â”‚
         â–¼
authService.updateUserRole()
         â”‚
         â–¼
supabase.from('profiles').update()
         â”‚
         â”œâ”€ âœ… ThÃ nh cÃ´ng
         â”‚   â””â”€ Profile cáº­p nháº­t trong DB
         â”‚   â””â”€ RLS cho phÃ©p (kiá»ƒm tra admin)
         â”‚   â””â”€ Tráº£ vá» user Ä‘Ã£ cáº­p nháº­t
         â”‚   â””â”€ Cáº­p nháº­t local state
         â”‚   â””â”€ UI refresh
         â”‚
         â””â”€ âŒ Lá»—i
             â””â”€ RLS tá»« chá»‘i (khÃ´ng pháº£i admin)
             â””â”€ Lá»—i database
             â””â”€ Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i
```

---

## PhÃ¢n Cáº¥p Component

```
App
â”œâ”€ AuthProvider
â”‚  â”œâ”€ LoginPage
â”‚  â”‚  â””â”€ useAuthActions
â”‚  â”‚     â””â”€ authService.signIn()
â”‚  â”‚
â”‚  â”œâ”€ RegisterPage
â”‚  â”‚  â””â”€ useAuthActions
â”‚  â”‚     â””â”€ authService.signUp()
â”‚  â”‚
â”‚  â”œâ”€ ProtectedRoute
â”‚  â”‚  â””â”€ Dashboard
â”‚  â”‚     â””â”€ useAuth()
â”‚  â”‚        â””â”€ useAuthActions()
â”‚  â”‚
â”‚  â”œâ”€ AdminPanel
â”‚  â”‚  â”œâ”€ UsersList
â”‚  â”‚  â”‚  â””â”€ useUserManagement()
â”‚  â”‚  â”‚     â””â”€ userService.getAllUsers()
â”‚  â”‚  â”‚
â”‚  â”‚  â”œâ”€ UserDetail
â”‚  â”‚  â”‚  â””â”€ useUserManagement()
â”‚  â”‚  â”‚     â””â”€ userService.changeUserRole()
â”‚  â”‚  â”‚     â””â”€ userService.banUser()
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€ ProfileForm
â”‚  â”‚     â””â”€ useAuthActions()
â”‚  â”‚        â””â”€ handleUpdateProfile()
â”‚  â”‚
â”‚  â””â”€ ProfilePage
â”‚     â””â”€ useAuth()
â”‚     â””â”€ useAuthActions()
```

---

## Luá»“ng Quáº£n LÃ½ State

### State ToÃ n Cá»¥c (AuthContext)

```
AuthContext State:
â”œâ”€ user
â”‚  â”œâ”€ id (UUID tá»« Supabase)
â”‚  â”œâ”€ email
â”‚  â””â”€ emailConfirmed
â”‚
â”œâ”€ profile
â”‚  â”œâ”€ user_id
â”‚  â”œâ”€ display_name
â”‚  â”œâ”€ email
â”‚  â”œâ”€ role (admin|editor|user)
â”‚  â”œâ”€ avatar_url
â”‚  â”œâ”€ bio
â”‚  â”œâ”€ is_banned
â”‚  â”œâ”€ created_at
â”‚  â”œâ”€ updated_at
â”‚  â””â”€ last_login_at
â”‚
â”œâ”€ isLoading (boolean)
â”œâ”€ error (string|null)
â””â”€ isAuthenticated (boolean - Ä‘Æ°á»£c suy ra tá»« user)

Actions:
â”œâ”€ login(email, password)
â”œâ”€ register(email, password, displayName)
â”œâ”€ logout()
â”œâ”€ updateProfile(updates)
â”œâ”€ updatePassword(newPassword)
â”œâ”€ requestPasswordReset(email)
â””â”€ Helper Methods:
   â”œâ”€ hasPermission(permission)
   â”œâ”€ isAdmin()
   â””â”€ isEditor()
```

### State Cá»¥c Bá»™ (Components)

```
LoginPage:
â”œâ”€ email
â”œâ”€ password
â”œâ”€ showPassword
â”œâ”€ formErrors
â””â”€ (Tá»« useAuthActions):
   â”œâ”€ isSubmitting
   â””â”€ actionError

RegisterPage:
â”œâ”€ email
â”œâ”€ displayName
â”œâ”€ password
â”œâ”€ confirmPassword
â”œâ”€ agreeTerms
â”œâ”€ showPassword
â”œâ”€ formErrors
â”œâ”€ passwordStrength
â”œâ”€ successMessage
â””â”€ (Tá»« useAuthActions):
   â”œâ”€ isSubmitting
   â””â”€ actionError

UsersList:
â””â”€ (Tá»« useUserManagement):
   â”œâ”€ users
   â”œâ”€ total
   â”œâ”€ page
   â”œâ”€ isLoading
   â”œâ”€ error
   â”œâ”€ search
   â””â”€ role filter
```

---

## Kiáº¿n TrÃºc Báº£o Máº­t

### RLS (Row Level Security) Policies

```
Báº£ng profiles:
â”œâ”€ SELECT
â”‚  â”œâ”€ User cÃ³ thá»ƒ xem profile cá»§a mÃ¬nh: auth.uid() = user_id
â”‚  â””â”€ Admin cÃ³ thá»ƒ xem táº¥t cáº£: role = 'admin'
â”‚
â”œâ”€ UPDATE
â”‚  â”œâ”€ User cÃ³ thá»ƒ cáº­p nháº­t cá»§a mÃ¬nh: auth.uid() = user_id
â”‚  â””â”€ Admin cÃ³ thá»ƒ cáº­p nháº­t báº¥t ká»³: role = 'admin'
â”‚
â””â”€ DELETE
   â””â”€ Admin cÃ³ thá»ƒ xÃ³a: role = 'admin'

Báº£ng activity_logs:
â”œâ”€ SELECT
â”‚  â”œâ”€ User cÃ³ thá»ƒ xem cá»§a mÃ¬nh: auth.uid() = user_id
â”‚  â””â”€ Admin cÃ³ thá»ƒ xem táº¥t cáº£: role = 'admin'
â”‚
â””â”€ INSERT
   â””â”€ User cÃ³ thá»ƒ log cá»§a mÃ¬nh: auth.uid() = user_id

storage/avatars:
â”œâ”€ SELECT: Public (ai cÅ©ng cÃ³ thá»ƒ xem)
â”œâ”€ INSERT: Users Ä‘Ã£ xÃ¡c thá»±c
â”œâ”€ UPDATE: Chá»§ sá»Ÿ há»¯u cÃ³ thá»ƒ cáº­p nháº­t
â””â”€ DELETE: Chá»§ sá»Ÿ há»¯u cÃ³ thá»ƒ xÃ³a
```

### Luá»“ng XÃ¡c Thá»±c

```
1. Password
   â”œâ”€ ÄÆ°á»£c hash bá»Ÿi Supabase (bcrypt)
   â”œâ”€ ÄÆ°á»£c salt
   â”œâ”€ KhÃ´ng bao giá» gá»­i Ä‘áº¿n frontend
   â””â”€ KhÃ´ng bao giá» lÆ°u trong localStorage

2. Session Token (JWT)
   â”œâ”€ ÄÆ°á»£c cáº¥p sau khi login
   â”œâ”€ LÆ°u trong localStorage
   â”œâ”€ Tá»± Ä‘á»™ng refresh trÆ°á»›c khi háº¿t háº¡n
   â”œâ”€ Sá»­ dá»¥ng cho API calls
   â””â”€ XÃ³a khi logout

3. XÃ¡c Minh Email
   â”œâ”€ Gá»­i sau khi Ä‘Äƒng kÃ½
   â”œâ”€ TÃ¹y chá»n/CÃ³ thá»ƒ cáº¥u hÃ¬nh
   â”œâ”€ NgÄƒn cháº·n tÃ i khoáº£n spam
   â””â”€ CÃ³ thá»ƒ cháº·n users chÆ°a xÃ¡c minh

4. Ghi Log Hoáº¡t Äá»™ng
   â”œâ”€ Theo dÃµi táº¥t cáº£ hÃ nh Ä‘á»™ng
   â”œâ”€ LÆ°u user_id, action, timestamp
   â”œâ”€ Há»¯u Ã­ch cho audit trail
   â””â”€ CÃ³ thá»ƒ phÃ¡t hiá»‡n hoáº¡t Ä‘á»™ng Ä‘Ã¡ng ngá»
```

---

## Quan Há»‡ Schema Database

```
auth.users (Supabase quáº£n lÃ½)
â””â”€ 1:1 â”€â”€â”€ profiles (báº£ng cá»§a chÃºng ta)
   â”œâ”€ user_id (FK)
   â”œâ”€ email
   â”œâ”€ display_name
   â”œâ”€ role
   â”œâ”€ avatar_url
   â”œâ”€ bio
   â”œâ”€ location
   â”œâ”€ phone_number
   â”œâ”€ is_banned
   â”œâ”€ created_at
   â”œâ”€ updated_at
   â””â”€ last_login_at

activity_logs (báº£ng cá»§a chÃºng ta)
â””â”€ N:1 â”€â”€â”€ profiles
   â”œâ”€ user_id (FK)
   â”œâ”€ id (PK)
   â”œâ”€ action
   â”œâ”€ resource_type
   â”œâ”€ resource_id
   â”œâ”€ details (JSON)
   â”œâ”€ ip_address
   â”œâ”€ user_agent
   â””â”€ created_at

storage/avatars (bucket cá»§a chÃºng ta)
â””â”€ ÄÆ°á»£c tham chiáº¿u bá»Ÿi profiles.avatar_url
   â”œâ”€ Truy cáº­p Ä‘á»c cÃ´ng khai
   â”œâ”€ User cÃ³ thá»ƒ upload
   â””â”€ CDN phÃ¢n phá»‘i
```

---

## Chu Ká»³ Request/Response

### Request ÄÄƒng Nháº­p

```
Frontend:
1. User Ä‘iá»n form
2. validateForm() âœ“
3. POST /auth/signInWithPassword
   {
     email: "user@example.com",
     password: "password123"
   }

Backend (Supabase):
1. Kiá»ƒm tra thÃ´ng tin Ä‘Äƒng nháº­p
2. Táº¡o JWT token
3. Tráº£ vá» session
   {
     user: { id, email, ... },
     session: { access_token, refresh_token },
     ...
   }

Frontend:
1. LÆ°u session trong localStorage
2. SIGNED_IN event kÃ­ch hoáº¡t
3. loadUserProfile(user.id)
4. Láº¥y tá»« báº£ng profiles
5. Cáº­p nháº­t AuthContext
6. Chuyá»ƒn hÆ°á»›ng Ä‘áº¿n dashboard
```

### Request Láº¥y User Profile

```
Frontend:
1. Cáº§n user profile
2. GET /rest/v1/profiles?user_id=eq.UUID
   Headers: Authorization: Bearer <JWT>

Backend (Supabase):
1. XÃ¡c minh JWT token
2. Kiá»ƒm tra RLS policy
   - User cÃ³ thá»ƒ truy cáº­p profile nÃ y khÃ´ng?
3. Tráº£ vá» dá»¯ liá»‡u hoáº·c 403

Frontend:
1. Nháº­n dá»¯ liá»‡u profile
2. Cáº­p nháº­t state
3. Re-render component
4. Hiá»ƒn thá»‹ thÃ´ng tin user
```

---

## Luá»“ng Xá»­ LÃ½ Lá»—i

```
Lá»—i Xáº£y Ra
â”‚
â”œâ”€ AuthService báº¯t lá»—i
â”‚  â””â”€ Log vÃ o console vá»›i prefix [AuthService]
â”‚  â””â”€ Tráº£ vá» { success: false, error: message }
â”‚
â”œâ”€ useAuthActions báº¯t lá»—i
â”‚  â””â”€ Äáº·t actionError state
â”‚  â””â”€ Tráº£ vá» { success: false, error: message }
â”‚
â”œâ”€ Component xá»­ lÃ½
â”‚  â”œâ”€ Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i cho user
â”‚  â”œâ”€ Cho phÃ©p user thá»­ láº¡i
â”‚  â”œâ”€ XÃ³a lá»—i khi thá»­ má»›i
â”‚  â””â”€ Log vÃ o analytics (tÃ¹y chá»n)
â”‚
â””â”€ User tháº¥y thÃ´ng bÃ¡o lá»—i thÃ¢n thiá»‡n
   â”œâ”€ "Email hoáº·c password khÃ´ng há»£p lá»‡"
   â”œâ”€ "Email Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½"
   â”œâ”€ "Lá»—i máº¡ng - vui lÃ²ng thá»­ láº¡i"
   â””â”€ v.v.
```

---

## Kiáº¿n TrÃºc Deployment

```
Development (localhost)
â”œâ”€ Frontend: http://localhost:5173
â”œâ”€ Supabase: your-project.supabase.co
â””â”€ localStorage: session tokens

Production (Vercel/Netlify)
â”œâ”€ Frontend: https://yourapp.com
â”œâ”€ Supabase: your-project.supabase.co
â”œâ”€ CORS: ÄÃ£ cáº¥u hÃ¬nh trong Supabase
â”œâ”€ localStorage: session tokens
â”œâ”€ HTTPS: Báº¯t buá»™c (secure cookies)
â””â”€ Environment: Production secrets

Supabase (Cloud)
â”œâ”€ Auth: Email/password + JWT
â”œâ”€ Database: PostgreSQL
â”œâ”€ RLS: ÄÃ£ báº­t & cáº¥u hÃ¬nh
â”œâ”€ Backups: Tá»± Ä‘á»™ng hÃ ng ngÃ y
â””â”€ Monitoring: TÃ­ch há»£p sáºµn
```

---

## CÃ¢n Nháº¯c Hiá»‡u Suáº¥t

### Chiáº¿n LÆ°á»£c Tá»‘i Æ¯u

```
1. Lazy Loading
   â”œâ”€ Import auth services Ä‘á»™ng
   â”œâ”€ Lazy load user management
   â””â”€ Code split trÃªn routes

2. Memoization
   â”œâ”€ useCallback cho functions
   â”œâ”€ useAuth() custom hook
   â””â”€ NgÄƒn re-render khÃ´ng cáº§n thiáº¿t

3. Database Queries
   â”œâ”€ Chá»‰ select cÃ¡c cá»™t cáº§n thiáº¿t
   â”œâ”€ Sá»­ dá»¥ng indexes cho queries thÆ°á»ng dÃ¹ng
   â”œâ”€ Giá»›i háº¡n káº¿t quáº£ vá»›i pagination
   â””â”€ Cache user profile

4. Network
   â”œâ”€ Session lÆ°u trong localStorage
   â”œâ”€ Giáº£m auth calls khi reload
   â”œâ”€ Tá»± Ä‘á»™ng refresh tokens
   â””â”€ CDN cho avatars

5. Rendering
   â”œâ”€ Conditional rendering
   â”œâ”€ Loading skeletons
   â”œâ”€ Debounce search
   â””â”€ Virtual lists cho danh sÃ¡ch user lá»›n
```

---

## Monitoring & Debugging

### Pattern Console Logs

```
[AuthContext] - Thay Ä‘á»•i state toÃ n cá»¥c
[authService] - Supabase API calls
[UserManagement] - Thao tÃ¡c Admin
[supabaseClient] - Khá»Ÿi táº¡o client

VÃ­ dá»¥:
[AuthContext] Auth state changed: SIGNED_IN
[authService] Sign in successful: user@example.com
[UserManagement] Fetched users: 45
[supabaseClient] Connection OK
```

### Browser DevTools

```
1. localStorage
   â””â”€ sb-glingo-auth-token
      â”œâ”€ access_token (JWT)
      â”œâ”€ refresh_token
      â””â”€ expires_at

2. Network Tab
   â”œâ”€ POST /auth/v1/token
   â”œâ”€ POST /rest/v1/profiles
   â”œâ”€ GET /rest/v1/profiles?...
   â””â”€ Theo dÃµi lá»—i 401/403

3. React DevTools
   â”œâ”€ GiÃ¡ trá»‹ AuthContext
   â”œâ”€ State component
   â””â”€ GiÃ¡ trá»‹ useAuth() hook

4. Console
   â”œâ”€ TÃ¬m logs [AuthContext]
   â”œâ”€ Theo dÃµi lá»—i
   â””â”€ Test functions trá»±c tiáº¿p
```

---

## Kiáº¿n TrÃºc NÃ y Cung Cáº¥p

âœ… **Kháº£ NÄƒng Má»Ÿ Rá»™ng** - Dá»… thÃªm tÃ­nh nÄƒng
âœ… **Báº£o Máº­t** - RLS, JWT, password hashing
âœ… **Kháº£ NÄƒng Báº£o TrÃ¬** - TÃ¡ch biá»‡t rÃµ rÃ ng cÃ¡c má»‘i quan tÃ¢m
âœ… **Hiá»‡u Suáº¥t** - Queries tá»‘i Æ°u & caching
âœ… **Äá»™ Tin Cáº­y** - Xá»­ lÃ½ lá»—i & logging
âœ… **Kháº£ NÄƒng Sá»­ Dá»¥ng** - Giao diá»‡n Ä‘áº¹p & UX mÆ°á»£t mÃ 
âœ… **TÃ i Liá»‡u** - Code Ä‘Æ°á»£c tÃ i liá»‡u tá»‘t
âœ… **Testing** - Dá»… test tá»«ng táº§ng

**Báº¡n cÃ³ má»™t há»‡ thá»‘ng authentication sáºµn sÃ ng production!** ğŸš€

